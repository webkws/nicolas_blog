<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>由 CommonsChunk 到 SplitChunk | Nicolas</title>
    <meta name="description" content="Winter is coming...">
    <link rel="icon" href="/nicolas_blog/logo.jpg">
  <link rel="manifest" href="/nicolas_blog/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/nicolas_blog/assets/css/0.styles.702c3d49.css" as="style"><link rel="preload" href="/nicolas_blog/assets/js/app.8757db7b.js" as="script"><link rel="preload" href="/nicolas_blog/assets/js/22.8b69b201.js" as="script"><link rel="prefetch" href="/nicolas_blog/assets/js/10.12fec6a4.js"><link rel="prefetch" href="/nicolas_blog/assets/js/2.46a28983.js"><link rel="prefetch" href="/nicolas_blog/assets/js/3.beca16df.js"><link rel="prefetch" href="/nicolas_blog/assets/js/4.1718758b.js"><link rel="prefetch" href="/nicolas_blog/assets/js/5.eac66c5d.js"><link rel="prefetch" href="/nicolas_blog/assets/js/6.af070ff6.js"><link rel="prefetch" href="/nicolas_blog/assets/js/7.d05c8e52.js"><link rel="prefetch" href="/nicolas_blog/assets/js/8.40f75c88.js"><link rel="prefetch" href="/nicolas_blog/assets/js/9.6edef93c.js"><link rel="prefetch" href="/nicolas_blog/assets/js/11.b0b60609.js"><link rel="prefetch" href="/nicolas_blog/assets/js/12.56bcea60.js"><link rel="prefetch" href="/nicolas_blog/assets/js/13.dbc3f0c5.js"><link rel="prefetch" href="/nicolas_blog/assets/js/14.4268a1c1.js"><link rel="prefetch" href="/nicolas_blog/assets/js/15.a82b5d46.js"><link rel="prefetch" href="/nicolas_blog/assets/js/16.6845d2c0.js"><link rel="prefetch" href="/nicolas_blog/assets/js/17.280974b2.js"><link rel="prefetch" href="/nicolas_blog/assets/js/18.3efbe42a.js"><link rel="prefetch" href="/nicolas_blog/assets/js/19.b2cfa31b.js"><link rel="prefetch" href="/nicolas_blog/assets/js/20.6150cfce.js"><link rel="prefetch" href="/nicolas_blog/assets/js/21.d6e364bc.js"><link rel="prefetch" href="/nicolas_blog/assets/js/23.3b3e70eb.js"><link rel="prefetch" href="/nicolas_blog/assets/js/24.ae14d3b9.js"><link rel="prefetch" href="/nicolas_blog/assets/js/25.8bd460fb.js"><link rel="prefetch" href="/nicolas_blog/assets/js/26.6431c747.js"><link rel="prefetch" href="/nicolas_blog/assets/js/27.28609ca5.js"><link rel="prefetch" href="/nicolas_blog/assets/js/28.069623ca.js"><link rel="prefetch" href="/nicolas_blog/assets/js/29.a95ca43d.js"><link rel="prefetch" href="/nicolas_blog/assets/js/30.1c0e0d8c.js">
    <link rel="stylesheet" href="/nicolas_blog/assets/css/0.styles.702c3d49.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nicolas_blog/" class="home-link router-link-active"><!----> <span class="site-name">Nicolas</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/nicolas_blog/docs/" class="nav-link">My Cheatsheets</a></div><div class="nav-item"><a href="/nicolas_blog/blogs/" class="nav-link router-link-active">My Blog</a></div><div class="nav-item"><a href="/nicolas_blog/about/" class="nav-link">About Me</a></div> <a href="https://github.com/webkws" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/nicolas_blog/docs/" class="nav-link">My Cheatsheets</a></div><div class="nav-item"><a href="/nicolas_blog/blogs/" class="nav-link router-link-active">My Blog</a></div><div class="nav-item"><a href="/nicolas_blog/about/" class="nav-link">About Me</a></div> <a href="https://github.com/webkws" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div class="carbon-ads"></div> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>My Blog</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/nicolas_blog/blogs/" class="sidebar-link">Vue Plugin实战</a></li><li><a href="/nicolas_blog/blogs/web_optimization.html" class="sidebar-link">Web性能优化</a></li><li><a href="/nicolas_blog/blogs/issues.html" class="sidebar-link">遇到过的Issue</a></li><li><a href="/nicolas_blog/blogs/curry_functions.html" class="sidebar-link">函数柯里化(Curry in JS)</a></li><li><a href="/nicolas_blog/blogs/safe_access.html" class="sidebar-link">前端中的Robust</a></li><li><a href="/nicolas_blog/blogs/canvas.html" class="sidebar-link">Canvas学习笔记</a></li><li><a href="/nicolas_blog/blogs/js_optimization.html" class="sidebar-link">js优化(只谈写法)</a></li><li><a href="/nicolas_blog/blogs/data_structures.html" class="sidebar-link">数据结构和算法</a></li><li><a href="/nicolas_blog/blogs/mobile_unit.html" class="sidebar-link">Mobile中的单位问题</a></li><li><a href="/nicolas_blog/blogs/sentry.html" class="sidebar-link">Sentry前端部署扩展</a></li><li><a href="/nicolas_blog/blogs/oocss.html" class="sidebar-link">Object-Oriented CSS</a></li><li><a href="/nicolas_blog/blogs/vue_inject.html" class="sidebar-link">Vue中的奇淫技巧</a></li><li><a href="/nicolas_blog/blogs/es6_tips.html" class="sidebar-link">ES6/ES7 Best Practice</a></li><li><a href="/nicolas_blog/blogs/sass.html" class="sidebar-link">只会嵌套不敢说自己会SASS</a></li><li><a href="/nicolas_blog/blogs/vue_watch.html" class="sidebar-link">如何在vue中remove一个watcher</a></li><li><a href="/nicolas_blog/blogs/webpack.html" class="active sidebar-link">由 CommonsChunk 到 SplitChunk</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nicolas_blog/blogs/webpack.html#webpack3中的commonschunkplugin" class="sidebar-link">webpack3中的CommonsChunkPlugin</a></li><li class="sidebar-sub-header"><a href="/nicolas_blog/blogs/webpack.html#webpack4中的splitchunkplugin" class="sidebar-link">webpack4中的SplitChunkPlugin</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="由-commonschunk-到-splitchunk"><a href="#由-commonschunk-到-splitchunk" aria-hidden="true" class="header-anchor">#</a> 由 CommonsChunk 到 SplitChunk</h1> <h2 id="webpack3中的commonschunkplugin"><a href="#webpack3中的commonschunkplugin" aria-hidden="true" class="header-anchor">#</a> webpack3中的CommonsChunkPlugin</h2> <p><strong>先上一套代码:</strong></p> <div class="language-js extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">//fuck.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fuck</span> <span class="token operator">=</span> item <span class="token operator">=&gt;</span> item <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">//main1.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>fuck<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./fuck'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$，<span class="token template-string"><span class="token string">`first  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fuck<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//main2.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>fuck<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./fuck'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$，<span class="token template-string"><span class="token string">`second </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fuck<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack3 中有一个插件<code>CommonsChunkPlugin</code>,打包时可以把多处 import 的模块提取到公共文件，避免重复下载。是用来提取第三方库和公共模块，避免首屏加载的 bundle 文件或者按需加载的 bundle 文件体积过大，从而导致加载时间过长，优化必备。</p> <p>过程不多说，直接上配置。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span>
  <span class="token function">minChunks</span> <span class="token punctuation">(</span>module<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>        
        module<span class="token punctuation">.</span>resource <span class="token operator">&amp;&amp;</span>
        <span class="token regex">/\.js$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>resource<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        module<span class="token punctuation">.</span>resource<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>
        path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../node_modules'</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'manifest'</span><span class="token punctuation">,</span>
    minChunks<span class="token punctuation">:</span> <span class="token number">Infinity</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span><span class="token punctuation">:</span> <span class="token string">'vendor-async'</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minChunks<span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>有一点需要注意，<code>[hash]</code>适用于开发环境，每次编译都会改变，而<code>[chunkhash]</code>适用于生产环境，为了迎合浏览器的缓存机制。所以在生产环境，output 的:
<code>chunkFilename: utils.assetsPath('js/[id].[chunkhash].js')</code></p> <ul><li>第一个配置，minChunks的规则是:
<code>minChunks: number|Infinity|function(module, count) =&gt; boolean</code>
使用上述函数的写法保证了vendor中,只保留第三方库。而不会把runtime webpack运行时的代码包括进去，因为不把<code>runtime</code>剥离出来，本地的代码一旦改变，无论引用的第三方库改不改变，<code>vendor</code>都会变，那样的话生产环境浏览器会再次加载。</li> <li>再说第二个配置<code>mainfest</code>:
用来引导所有模块的交互。manifest文件包含了加载和处理模块的逻辑，有了它，runtime会根据manifest文件来处理和加载模块</li> <li>再说第三个配置<code>async</code>和<code>children</code>的使用方法:
包含require.ensure,AMD,import()</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
#<span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>中是依赖，callback中写入require的东西，最后一个参数是output的chunkFilename
require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>require<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./first.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
#<span class="token number">2</span><span class="token punctuation">:</span>返回一个promise
<span class="token keyword">import</span><span class="token punctuation">(</span>'<span class="token punctuation">.</span><span class="token operator">/</span><span class="token keyword">async</span><span class="token punctuation">.</span>js<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token operator">...</span> <span class="token punctuation">)</span>
</code></pre></div><ul><li>Lazy Loading，懒加载或者按需加载，属于code split的一部分。当chilren为true的时候，<code>source chunk</code>通过<code>entry chunks</code>进行code split,children 可以用来把 <code>entry chunk</code> 创建的 <code>children chunks</code> 的共用模块合并到自身，但这会导致初始加载时间较长.async就解决了children:true时合并到<code>entry chunks</code>自身时初始加载时间过长的问题，async设为true时，<code>commons chunk</code> 将不会合并到自身，而是使用一个新的异步的<code>commons chunk</code>。当这个<code>children chunk</code> 被下载时，自动并行下载该<code>commons chunk</code>。具体的分析可以看<a href="http://qiutianaimeili.com/html/page/2018/06/d348hdviz3w.html" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>chunk分为async和sync</li></ul> <blockquote><p>Async chunks are loaded on demand (lazy loaded) and you would see network request for async chunk files in developers tool.</p></blockquote> <h2 id="webpack4中的splitchunkplugin"><a href="#webpack4中的splitchunkplugin" aria-hidden="true" class="header-anchor">#</a> webpack4中的SplitChunkPlugin</h2> <div class="tip custom-block"><p class="custom-block-title">webpack文档中有这么一句话</p> <p>Originally, chunks (and modules imported inside them) were connected by a parent-child relationship in the internal webpack graph. The CommonsChunkPlugin was used to avoid duplicated dependencies across them, but further optimizations were not possible.</p></div> <p>每次切割之后，生成一种父子关系，更深一步的优化还是要靠SplitChunkPlugin</p> <p>借用老外的一篇文章把chunk分为了三种：</p> <ul><li><p><strong>Vendor Chunk</strong> Create separate files for <code>vendor code</code> (3rd party code coming from <code>node_modules</code>). A single vendor.js file will suffice. Any vendor code used inside <code>index.js</code> (<code>import</code> statements of <code>npm</code> modules) will be break from it and form <code>vendor.js</code> which will be loaded synchronously with <code>main.js</code>.</p></li> <li><p><strong>Async Chunks</strong> Create separate files for code which can be lazy loaded. Like a file for every <code>Route of React router</code> which can be <strong>lazy loaded when route is changed</strong>. Webpack inject some code into <code>main.js</code> which takes care of lazy loading async chunks and stops from loading same chunks again and again. When route changes, React router calls a Webpack function to load a chunk file and Webpack after done loading runs it, which chunk would internally ask React to do something.</p></li> <li><p><strong>Common Chunk</strong> Create common file from code which is shared between different chunks. For example, if 10 routes create 10 different async chunks and these chunks have a common <code>import</code> statement, then code associated with that <code>import</code> statement will get injected into respective chunk files separately. That would load same piece of code every single time we change the route, which is not a very good for UX. Instead, we could take out common code shared between different chunks and create <code>common.js</code> file which will be loaded synchronously with main.js beforehand.</p></li></ul> <h3 id="webpack-s-import"><a href="#webpack-s-import" aria-hidden="true" class="header-anchor">#</a> webpack's import</h3> <p>webpack自带import(module)来处理异步，返回一个promise，这个module可以是npm也可以是本地的模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//async.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'fuck'</span><span class="token punctuation">;</span>

<span class="token comment">//index.js</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./async.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> data <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>这一步会报错，因为它和es6的<code>import</code>冲突了,需要安装<code>babel-plugin-syntax-dynamic-import</code>;
然后运行，看时间线，会发现<code>0.main.js</code>是异步加载的,这里就包含了async.js中所有export出的value</p> <p><img src="/nicolas_blog/assets/img/webpack-timeline.24317634.png" alt="An image"></p> <h3 id="接下来说import-和vue-router"><a href="#接下来说import-和vue-router" aria-hidden="true" class="header-anchor">#</a> 接下来说import()和vue-router</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>BrowserRouter<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;menu&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Link exact to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> activeClassName<span class="token operator">=</span><span class="token string">&quot;active&quot;</span><span class="token operator">&gt;</span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/about&quot;</span> activeClassName<span class="token operator">=</span><span class="token string">&quot;active&quot;</span><span class="token operator">&gt;</span>About<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/contact&quot;</span> activeClassName<span class="token operator">=</span><span class="token string">&quot;active&quot;</span><span class="token operator">&gt;</span>Contact<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        
        <span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span> HomeComponent <span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/about&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span> AboutComponent <span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/contact&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span> AsyncContactComponent <span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">&gt;</span>
</code></pre></div><p>代码所示，contact对应的路由，prop传递一个异步组件,我们现在来模拟一下异步加载。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// yarn add react-loadable -S 满足异步组件之前可以显示loading</span>

<span class="token keyword">import</span> loadable <span class="token keyword">from</span> <span class="token string">'react-loadable'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">LoadingComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>please wait<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">ContactComponentPromise</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./ContactComponent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> AsyncContactComponent <span class="token operator">=</span> <span class="token function">loadable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span> ContactComponentPromise<span class="token punctuation">,</span>
    loading<span class="token punctuation">:</span> LoadingComponent
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>然后观察时间线，或者页面的表现，会发现1.main.js是异步加载的</p> <h3 id="下面说splitchunksplugin的配置"><a href="#下面说splitchunksplugin的配置" aria-hidden="true" class="header-anchor">#</a> 下面说SplitChunksPlugin的配置</h3> <div class="language-js extra-class"><pre class="language-js"><code>splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    chunks<span class="token punctuation">:</span> <span class="token string">&quot;async&quot;</span><span class="token punctuation">,</span><span class="token comment">//有all, async, and initial 还可以写函数retrun</span>
    <span class="token comment">// chunks(chunk){</span>
    <span class="token comment">//     return chunk.name !== 'my-excluded-chunk'</span>
    <span class="token comment">// }</span>
    minSize<span class="token punctuation">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
    minChunks<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">//共享该module的最小chunk数</span>
    maxAsyncRequests<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    maxInitialRequests<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    automaticNameDelimiter<span class="token punctuation">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        vendors<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            test<span class="token punctuation">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
            priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    	<span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">//共享该module的最小chunk数</span>
            priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token comment">//优先级</span>
            reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://itnext.io/react-router-and-webpack-v4-code-splitting-using-splitchunksplugin-f0a48f110312" target="_blank" rel="noopener noreferrer">参考文献1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://juejin.im/post/5af15e895188256715479a9a" target="_blank" rel="noopener noreferrer">参考文献2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">9/1/2018, 3:31:09 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/nicolas_blog/blogs/vue_watch.html" class="prev">
          如何在vue中remove一个watcher
        </a></span> <!----></p></div> <div class="bsa-cpc-wrapper"><div class="bsa-cpc"></div></div></div> <!----></div></div>
    <script src="/nicolas_blog/assets/js/22.8b69b201.js" defer></script><script src="/nicolas_blog/assets/js/app.8757db7b.js" defer></script>
  </body>
</html>
