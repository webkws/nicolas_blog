<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>遇到过的Issue | Nicolas</title>
    <meta name="description" content="Winter is coming...">
    <link rel="icon" href="/nicolas_blog/logo.jpg">
  <link rel="manifest" href="/nicolas_blog/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/nicolas_blog/assets/css/0.styles.702c3d49.css" as="style"><link rel="preload" href="/nicolas_blog/assets/js/app.8757db7b.js" as="script"><link rel="preload" href="/nicolas_blog/assets/js/12.56bcea60.js" as="script"><link rel="preload" href="/nicolas_blog/assets/js/3.beca16df.js" as="script"><link rel="prefetch" href="/nicolas_blog/assets/js/10.12fec6a4.js"><link rel="prefetch" href="/nicolas_blog/assets/js/2.46a28983.js"><link rel="prefetch" href="/nicolas_blog/assets/js/4.1718758b.js"><link rel="prefetch" href="/nicolas_blog/assets/js/5.eac66c5d.js"><link rel="prefetch" href="/nicolas_blog/assets/js/6.af070ff6.js"><link rel="prefetch" href="/nicolas_blog/assets/js/7.d05c8e52.js"><link rel="prefetch" href="/nicolas_blog/assets/js/8.40f75c88.js"><link rel="prefetch" href="/nicolas_blog/assets/js/9.6edef93c.js"><link rel="prefetch" href="/nicolas_blog/assets/js/11.b0b60609.js"><link rel="prefetch" href="/nicolas_blog/assets/js/13.dbc3f0c5.js"><link rel="prefetch" href="/nicolas_blog/assets/js/14.4268a1c1.js"><link rel="prefetch" href="/nicolas_blog/assets/js/15.a82b5d46.js"><link rel="prefetch" href="/nicolas_blog/assets/js/16.6845d2c0.js"><link rel="prefetch" href="/nicolas_blog/assets/js/17.280974b2.js"><link rel="prefetch" href="/nicolas_blog/assets/js/18.3efbe42a.js"><link rel="prefetch" href="/nicolas_blog/assets/js/19.b2cfa31b.js"><link rel="prefetch" href="/nicolas_blog/assets/js/20.6150cfce.js"><link rel="prefetch" href="/nicolas_blog/assets/js/21.d6e364bc.js"><link rel="prefetch" href="/nicolas_blog/assets/js/22.8b69b201.js"><link rel="prefetch" href="/nicolas_blog/assets/js/23.3b3e70eb.js"><link rel="prefetch" href="/nicolas_blog/assets/js/24.ae14d3b9.js"><link rel="prefetch" href="/nicolas_blog/assets/js/25.8bd460fb.js"><link rel="prefetch" href="/nicolas_blog/assets/js/26.6431c747.js"><link rel="prefetch" href="/nicolas_blog/assets/js/27.28609ca5.js"><link rel="prefetch" href="/nicolas_blog/assets/js/28.069623ca.js"><link rel="prefetch" href="/nicolas_blog/assets/js/29.a95ca43d.js"><link rel="prefetch" href="/nicolas_blog/assets/js/30.1c0e0d8c.js">
    <link rel="stylesheet" href="/nicolas_blog/assets/css/0.styles.702c3d49.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nicolas_blog/" class="home-link router-link-active"><!----> <span class="site-name">Nicolas</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/nicolas_blog/docs/" class="nav-link">My Cheatsheets</a></div><div class="nav-item"><a href="/nicolas_blog/blogs/" class="nav-link router-link-active">My Blog</a></div><div class="nav-item"><a href="/nicolas_blog/about/" class="nav-link">About Me</a></div> <a href="https://github.com/webkws" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/nicolas_blog/docs/" class="nav-link">My Cheatsheets</a></div><div class="nav-item"><a href="/nicolas_blog/blogs/" class="nav-link router-link-active">My Blog</a></div><div class="nav-item"><a href="/nicolas_blog/about/" class="nav-link">About Me</a></div> <a href="https://github.com/webkws" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div class="carbon-ads"></div> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>My Blog</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/nicolas_blog/blogs/" class="sidebar-link">Vue Plugin实战</a></li><li><a href="/nicolas_blog/blogs/web_optimization.html" class="sidebar-link">Web性能优化</a></li><li><a href="/nicolas_blog/blogs/issues.html" class="active sidebar-link">遇到过的Issue</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/nicolas_blog/blogs/curry_functions.html" class="sidebar-link">函数柯里化(Curry in JS)</a></li><li><a href="/nicolas_blog/blogs/safe_access.html" class="sidebar-link">前端中的Robust</a></li><li><a href="/nicolas_blog/blogs/canvas.html" class="sidebar-link">Canvas学习笔记</a></li><li><a href="/nicolas_blog/blogs/js_optimization.html" class="sidebar-link">js优化(只谈写法)</a></li><li><a href="/nicolas_blog/blogs/data_structures.html" class="sidebar-link">数据结构和算法</a></li><li><a href="/nicolas_blog/blogs/mobile_unit.html" class="sidebar-link">Mobile中的单位问题</a></li><li><a href="/nicolas_blog/blogs/sentry.html" class="sidebar-link">Sentry前端部署扩展</a></li><li><a href="/nicolas_blog/blogs/oocss.html" class="sidebar-link">Object-Oriented CSS</a></li><li><a href="/nicolas_blog/blogs/vue_inject.html" class="sidebar-link">Vue中的奇淫技巧</a></li><li><a href="/nicolas_blog/blogs/es6_tips.html" class="sidebar-link">ES6/ES7 Best Practice</a></li><li><a href="/nicolas_blog/blogs/sass.html" class="sidebar-link">只会嵌套不敢说自己会SASS</a></li><li><a href="/nicolas_blog/blogs/vue_watch.html" class="sidebar-link">如何在vue中remove一个watcher</a></li><li><a href="/nicolas_blog/blogs/webpack.html" class="sidebar-link">由 CommonsChunk 到 SplitChunk</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="遇到过的issue"><a href="#遇到过的issue" aria-hidden="true" class="header-anchor">#</a> 遇到过的Issue <span class="badge tip top" data-v-099ab69c>0.10.1+</span></h1> <h3 id="雪碧图可以避免图片加载慢造成的hover闪烁效果"><a href="#雪碧图可以避免图片加载慢造成的hover闪烁效果" aria-hidden="true" class="header-anchor">#</a> 雪碧图可以避免图片加载慢造成的hover闪烁效果</h3> <p>做过一次tab选项卡，显示图片的，看谷歌的时间线，图片加载过慢，导致选项卡都切换成功了，图片闪动的出现在了屏幕上,解决方案最后用的雪碧图</p> <div class="language-css extra-class"><pre class="language-css"><code>$<span class="token property">img-width</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
$<span class="token property">img-height</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
$<span class="token property">bgImg</span><span class="token punctuation">:</span> image-<span class="token url">url('toolbar.png')</span><span class="token punctuation">;</span>
<span class="token atrule"><span class="token rule">@media-img</span></span> <span class="token punctuation">{</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> $bgImg<span class="token punctuation">;</span>
  <span class="token property">background-position</span><span class="token punctuation">:</span> <span class="token function">-</span><span class="token punctuation">(</span>$img-width * 5<span class="token punctuation">)</span> <span class="token function">-</span><span class="token punctuation">(</span>$img-height * 1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> $img-width<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> $img-height<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="js-ios-iphone的safari不兼容javascript中的date-问题"><a href="#js-ios-iphone的safari不兼容javascript中的date-问题" aria-hidden="true" class="header-anchor">#</a> JS IOS/iPhone的Safari不兼容Javascript中的Date()问题</h3> <p>上图
<img src="/nicolas_blog/assets/img/ios_date.8b42e810.png" alt="An image">
如图所示，上次后端返回第一种格式，safari浏览器invalid，查了一下<a href="http://ecma-international.org/ecma-262/5.1/#sec-15.9.1.15" target="_blank" rel="noopener noreferrer">ECMA<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,更改如下:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> dateString <span class="token operator">=</span> <span class="token string">&quot;2018-12-31 00:00:00&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>dateString<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'T'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或</span>
<span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>dateString<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/-/g</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>这两种情况的容错判断要记得加，若后端返回空，容易报错</strong>,最好的解决办法直接用<a href="https://date-fns.org/" target="_blank" rel="noopener noreferrer">date-fns<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="vue中的tab切换和unwatch解决重复http请求"><a href="#vue中的tab切换和unwatch解决重复http请求" aria-hidden="true" class="header-anchor">#</a> vue中的tab切换和unwatch解决重复http请求</h3> <p>问题描述：vue中<code>SPA</code>模式下的，三个选项卡，分别对应三个select（一共9个）来进行列表查询，查询条件被vue，listen，然后getlist。切换tab的首次来获取后端返回的<code>droplist</code>来进行select渲染，这时候会遇到多次http请求的情况，因为listen到了多次变化。
解决方案就是利用vue的<code>unwatch</code> api</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//监听条件列表</span>
<span class="token keyword">const</span> statusSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> statusArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;param1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;param2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;param3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;param4&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//fire函数</span>
<span class="token keyword">function</span> <span class="token function">initWatchers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  statusSet<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  statusArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      statusSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> val <span class="token operator">=&gt;</span> val <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// fire them</span>
    initWatchers<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//methods中</span>
<span class="token function">changeTab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// unwatch</span>
    statusSet<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>fire <span class="token operator">=&gt;</span> <span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...处理droplist,并且赋值status初始值</span>
    <span class="token comment">//然后继续fire</span>
    initWatchers<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="后端返回列表后数据格式化处理较为繁琐"><a href="#后端返回列表后数据格式化处理较为繁琐" aria-hidden="true" class="header-anchor">#</a> 后端返回列表后数据格式化处理较为繁琐</h3> <div class="language-html extra-class"><pre class="language-html"><code>//before
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>充值<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>save<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:formatter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>formatter1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>活动<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>event<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:formatter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>formatter2<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>时间<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>time<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:formatter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>formatter3<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>总不能命令后端更改返回格式吧，前端来处理吧！</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//写在vue中或者mixin中，reuse也可以</span>
<span class="token function-variable function">format</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>save<span class="token punctuation">,</span> <span class="token operator">...</span>props<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>saveVal<span class="token punctuation">:</span> <span class="token function">mat</span><span class="token punctuation">(</span>save<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>props<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//use in list</span>
<span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axiosPlus</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> parObj<span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>users<span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>_ <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>format<span class="token operator">?</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">:</span>_<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="foreach的return毫无意义"><a href="#foreach的return毫无意义" aria-hidden="true" class="header-anchor">#</a> forEach的return毫无意义</h3> <div class="language-js extra-class"><pre class="language-js"><code>collection<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>不会跳出包裹函数或者循环.
<code>array#forEach simply does not care for the return value of its worker function. It just executes the worker function for each array element.You could use the worker function to set an outer variable</code> <a href="https://stackoverflow.com/questions/43555904/foreach-for-in-not-returning-values" target="_blank" rel="noopener noreferrer">分析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">truthCheck</span><span class="token punctuation">(</span>collection<span class="token punctuation">,</span> pre<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> allAreTruthy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  collection<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// if this ever flips allAreTruthy to false, it will stay false</span>
    allAreTruthy <span class="token operator">=</span> allAreTruthy <span class="token operator">&amp;&amp;</span> elem<span class="token punctuation">[</span>pre<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> allAreTruthy<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="css同名不会再次加载问题"><a href="#css同名不会再次加载问题" aria-hidden="true" class="header-anchor">#</a> css同名不会再次加载问题</h3> <p>在页面跳转的时候总有几个页面，在跳到该页面时样式全错位了，但是刷新一下就又好了,是因为跳转的时候 同class不会再次加载,而是沿用了前一个页面的,在起名的时候可以自行区分,或者使用<code>scoped</code>来增加哈希值</p> <h3 id="vh单位手机端遇到键盘弹出-此时vh不会计算键盘的"><a href="#vh单位手机端遇到键盘弹出-此时vh不会计算键盘的" aria-hidden="true" class="header-anchor">#</a> vh单位手机端遇到键盘弹出 此时vh不会计算键盘的</h3> <p>主流浏览器的宽高像素比基本都是 1.777,换成vw 勉强解决.</p> <h3 id="css技巧"><a href="#css技巧" aria-hidden="true" class="header-anchor">#</a> css技巧</h3> <p>.el-button + .el-button选择器，可以忽略第一个dom，不错。</p> <h3 id="box-shadow无效问题"><a href="#box-shadow无效问题" aria-hidden="true" class="header-anchor">#</a> box-shadow无效问题</h3> <p>Sarafi的表格元素box-shadow即使是加了prefix也会无效</p> <p><a href="https://stackoverflow.com/questions/7610021/applying-box-shadow-to-tbody-in-safari" target="_blank" rel="noopener noreferrer">解决方案居然是加display:block<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="contenteditable属性-兼容性差-不如focuout的时候-赋值"><a href="#contenteditable属性-兼容性差-不如focuout的时候-赋值" aria-hidden="true" class="header-anchor">#</a> contenteditable属性 兼容性差 不如focuout的时候 赋值</h3> <p><a href="https://stackoverflow.com/questions/46487619/contenteditable-div-append-a-html-element-and-v-model-it-in-vuejs" target="_blank" rel="noopener noreferrer">直达<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>✈️</p> <h3 id="_1px边框在部分移动端变粗问题产生"><a href="#_1px边框在部分移动端变粗问题产生" aria-hidden="true" class="header-anchor">#</a> 1px边框在部分移动端变粗问题产生</h3> <p>物理像素是最小单元，而css的1px控制的是逻辑像素，在retina dpr为2屏幕下是占有2X2物流像素的.</p> <p><strong>实际上，如果拿到750的设计稿，border量取的是1px solid red;然而iphone6中的实际像素却是375px;那么设计师实际需要的就是0.5px;不是1px变粗了，而是实际只需要0.5px而已</strong> <a href="https://www.w3cplus.com/css/fix-1px-for-retina.html" target="_blank" rel="noopener noreferrer">1px解决方案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://codepen.io/foolkai/pen/**QEgzLm**" target="_blank" rel="noopener noreferrer">demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="canvas跨域问题"><a href="#canvas跨域问题" aria-hidden="true" class="header-anchor">#</a> canvas跨域问题</h3> <p>canvas的getImageData有时候会遇到图片跨域问题.
解决方案:服务器端设置<code>Access-Control-Allow-Origin</code>的<code>header</code> 就可以把image转为canvas</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    src <span class="token operator">=</span> <span class="token string">&quot;http://example.com/image.jpg&quot;</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> img<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> img<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
</code></pre></div><p>但是<code>toDataURL</code>还是会报错,根据html5的规则，图片需要设置<code>crossOrigin</code>值,<code>in order to allow the browser to read the pixel data back from the canvas</code></p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/^([\w]+\:)?\/\//</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> src<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>host<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  img<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">&quot;anonymous&quot;</span><span class="token punctuation">;</span> <span class="token comment">// or &quot;use-credentials&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="微信浏览器打开页面-被阻止问题"><a href="#微信浏览器打开页面-被阻止问题" aria-hidden="true" class="header-anchor">#</a> 微信浏览器打开页面 被阻止问题</h3> <p><code>微信浏览器</code>和<code>safari</code>打开新标签会遇到弹出被阻止问题.
原理:
<code>当window.open为用户触发事件内部或者加载时，不会被拦截，一旦将弹出代码移动到ajax或者一段异步代码内部，马上就出现被拦截的表现了(浏览器认为这可能是一个广告，不是一个用户希望看到的页面)</code></p> <p>解决方案</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//异步代码中获取直播地址</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token comment">//直播地址);</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//href属性更改后模拟点击,让浏览器以为是用户自己主动点击的，而不是自动弹出的广告</span>
</code></pre></div><p>额外的解决方案微信和safari多测试一下:
<a href="https://stackoverflow.com/questions/6628949/window-open-popup-getting-blocked-during-click-event" target="_blank" rel="noopener noreferrer">blocked<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="微信h5图分享问题"><a href="#微信h5图分享问题" aria-hidden="true" class="header-anchor">#</a> 微信h5图分享问题</h3> <p>微信在长按图片保存分享的时候，如果图片来源于后端，且需要session权限，此时就无法分享给朋友，需要先将后端动态生成给前端的图保存到本地base64.</p> <h3 id="js的连续赋值"><a href="#js的连续赋值" aria-hidden="true" class="header-anchor">#</a> js的连续赋值</h3> <p><a href="https://stackoverflow.com/questions/1758576/multiple-left-hand-assignment-with-javascript" target="_blank" rel="noopener noreferrer">注意事项<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="fastclick问题"><a href="#fastclick问题" aria-hidden="true" class="header-anchor">#</a> fastclick问题</h3> <p>着手一个项目，发现移动端输入框苹果端需要双击才可以focus, 找了半天才发现fastclick有 <a href="https://github.com/ftlabs/fastclick/issues/582" target="_blank" rel="noopener noreferrer">issue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
而fastclick对videojs播放器有影响，遍历给videojs对按钮<a href="https://stackoverflow.com/questions/28216483/how-to-remove-fastclick-from-a-specific-element" target="_blank" rel="noopener noreferrer">加className<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>就可以了,或者是<a href="https://github.com/ftlabs/fastclick/issues/234" target="_blank" rel="noopener noreferrer">unbind<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="canvas画图模糊问题"><a href="#canvas画图模糊问题" aria-hidden="true" class="header-anchor">#</a> canvas画图模糊问题</h3> <p>是dpr问题, 解决方案如下</p> <p><a href="https://juejin.im/post/5aea7bb85188251cc953b71a" target="_blank" rel="noopener noreferrer">resolve1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://stackoverflow.com/questions/24395076/canvas-generated-by-canvg-is-blurry-on-retina-screen" target="_blank" rel="noopener noreferrer">resolve2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://stackoverflow.com/questions/5063489/how-can-you-get-the-css-pixel-device-pixel-ratio" target="_blank" rel="noopener noreferrer">获取dpr兼容方案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="vue-router的权限路由问题"><a href="#vue-router的权限路由问题" aria-hidden="true" class="header-anchor">#</a> vue-router的权限路由问题</h3></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">7/2/2019, 11:16:30 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/nicolas_blog/blogs/web_optimization.html" class="prev">
          Web性能优化
        </a></span> <span class="next"><a href="/nicolas_blog/blogs/curry_functions.html">
          函数柯里化(Curry in JS)
        </a>
        →
      </span></p></div> <div class="bsa-cpc-wrapper"><div class="bsa-cpc"></div></div></div> <!----></div></div>
    <script src="/nicolas_blog/assets/js/12.56bcea60.js" defer></script><script src="/nicolas_blog/assets/js/3.beca16df.js" defer></script><script src="/nicolas_blog/assets/js/app.8757db7b.js" defer></script>
  </body>
</html>
