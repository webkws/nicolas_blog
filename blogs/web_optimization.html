<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Web性能优化 | Nicolas</title>
    <meta name="description" content="Winter is coming...">
    <link rel="icon" href="/nicolas_blog/logo.jpg">
  <link rel="manifest" href="/nicolas_blog/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/nicolas_blog/assets/css/0.styles.702c3d49.css" as="style"><link rel="preload" href="/nicolas_blog/assets/js/app.8757db7b.js" as="script"><link rel="preload" href="/nicolas_blog/assets/js/21.d6e364bc.js" as="script"><link rel="preload" href="/nicolas_blog/assets/js/3.beca16df.js" as="script"><link rel="prefetch" href="/nicolas_blog/assets/js/10.12fec6a4.js"><link rel="prefetch" href="/nicolas_blog/assets/js/2.46a28983.js"><link rel="prefetch" href="/nicolas_blog/assets/js/4.1718758b.js"><link rel="prefetch" href="/nicolas_blog/assets/js/5.eac66c5d.js"><link rel="prefetch" href="/nicolas_blog/assets/js/6.af070ff6.js"><link rel="prefetch" href="/nicolas_blog/assets/js/7.d05c8e52.js"><link rel="prefetch" href="/nicolas_blog/assets/js/8.40f75c88.js"><link rel="prefetch" href="/nicolas_blog/assets/js/9.6edef93c.js"><link rel="prefetch" href="/nicolas_blog/assets/js/11.b0b60609.js"><link rel="prefetch" href="/nicolas_blog/assets/js/12.56bcea60.js"><link rel="prefetch" href="/nicolas_blog/assets/js/13.dbc3f0c5.js"><link rel="prefetch" href="/nicolas_blog/assets/js/14.4268a1c1.js"><link rel="prefetch" href="/nicolas_blog/assets/js/15.a82b5d46.js"><link rel="prefetch" href="/nicolas_blog/assets/js/16.6845d2c0.js"><link rel="prefetch" href="/nicolas_blog/assets/js/17.280974b2.js"><link rel="prefetch" href="/nicolas_blog/assets/js/18.3efbe42a.js"><link rel="prefetch" href="/nicolas_blog/assets/js/19.b2cfa31b.js"><link rel="prefetch" href="/nicolas_blog/assets/js/20.6150cfce.js"><link rel="prefetch" href="/nicolas_blog/assets/js/22.8b69b201.js"><link rel="prefetch" href="/nicolas_blog/assets/js/23.3b3e70eb.js"><link rel="prefetch" href="/nicolas_blog/assets/js/24.ae14d3b9.js"><link rel="prefetch" href="/nicolas_blog/assets/js/25.8bd460fb.js"><link rel="prefetch" href="/nicolas_blog/assets/js/26.6431c747.js"><link rel="prefetch" href="/nicolas_blog/assets/js/27.28609ca5.js"><link rel="prefetch" href="/nicolas_blog/assets/js/28.069623ca.js"><link rel="prefetch" href="/nicolas_blog/assets/js/29.a95ca43d.js"><link rel="prefetch" href="/nicolas_blog/assets/js/30.1c0e0d8c.js">
    <link rel="stylesheet" href="/nicolas_blog/assets/css/0.styles.702c3d49.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nicolas_blog/" class="home-link router-link-active"><!----> <span class="site-name">Nicolas</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/nicolas_blog/docs/" class="nav-link">My Cheatsheets</a></div><div class="nav-item"><a href="/nicolas_blog/blogs/" class="nav-link router-link-active">My Blog</a></div><div class="nav-item"><a href="/nicolas_blog/about/" class="nav-link">About Me</a></div> <a href="https://github.com/webkws" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/nicolas_blog/docs/" class="nav-link">My Cheatsheets</a></div><div class="nav-item"><a href="/nicolas_blog/blogs/" class="nav-link router-link-active">My Blog</a></div><div class="nav-item"><a href="/nicolas_blog/about/" class="nav-link">About Me</a></div> <a href="https://github.com/webkws" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div class="carbon-ads"></div> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>My Blog</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/nicolas_blog/blogs/" class="sidebar-link">Vue Plugin实战</a></li><li><a href="/nicolas_blog/blogs/web_optimization.html" class="active sidebar-link">Web性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nicolas_blog/blogs/web_optimization.html#资源的合并与压缩" class="sidebar-link">资源的合并与压缩</a></li><li class="sidebar-sub-header"><a href="/nicolas_blog/blogs/web_optimization.html#图片相关的优化" class="sidebar-link">图片相关的优化</a></li><li class="sidebar-sub-header"><a href="/nicolas_blog/blogs/web_optimization.html#css、js的加载与执行" class="sidebar-link">css、js的加载与执行</a></li><li class="sidebar-sub-header"><a href="/nicolas_blog/blogs/web_optimization.html#重绘与回流" class="sidebar-link">重绘与回流</a></li><li class="sidebar-sub-header"><a href="/nicolas_blog/blogs/web_optimization.html#浏览器存储" class="sidebar-link">浏览器存储</a></li><li class="sidebar-sub-header"><a href="/nicolas_blog/blogs/web_optimization.html#service-worker" class="sidebar-link">service worker</a></li><li class="sidebar-sub-header"><a href="/nicolas_blog/blogs/web_optimization.html#缓存" class="sidebar-link">缓存</a></li><li class="sidebar-sub-header"><a href="/nicolas_blog/blogs/web_optimization.html#ssr" class="sidebar-link">SSR</a></li></ul></li><li><a href="/nicolas_blog/blogs/issues.html" class="sidebar-link">遇到过的Issue</a></li><li><a href="/nicolas_blog/blogs/curry_functions.html" class="sidebar-link">函数柯里化(Curry in JS)</a></li><li><a href="/nicolas_blog/blogs/safe_access.html" class="sidebar-link">前端中的Robust</a></li><li><a href="/nicolas_blog/blogs/canvas.html" class="sidebar-link">Canvas学习笔记</a></li><li><a href="/nicolas_blog/blogs/js_optimization.html" class="sidebar-link">js优化(只谈写法)</a></li><li><a href="/nicolas_blog/blogs/data_structures.html" class="sidebar-link">数据结构和算法</a></li><li><a href="/nicolas_blog/blogs/mobile_unit.html" class="sidebar-link">Mobile中的单位问题</a></li><li><a href="/nicolas_blog/blogs/sentry.html" class="sidebar-link">Sentry前端部署扩展</a></li><li><a href="/nicolas_blog/blogs/oocss.html" class="sidebar-link">Object-Oriented CSS</a></li><li><a href="/nicolas_blog/blogs/vue_inject.html" class="sidebar-link">Vue中的奇淫技巧</a></li><li><a href="/nicolas_blog/blogs/es6_tips.html" class="sidebar-link">ES6/ES7 Best Practice</a></li><li><a href="/nicolas_blog/blogs/sass.html" class="sidebar-link">只会嵌套不敢说自己会SASS</a></li><li><a href="/nicolas_blog/blogs/vue_watch.html" class="sidebar-link">如何在vue中remove一个watcher</a></li><li><a href="/nicolas_blog/blogs/webpack.html" class="sidebar-link">由 CommonsChunk 到 SplitChunk</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="web性能优化"><a href="#web性能优化" aria-hidden="true" class="header-anchor">#</a> Web性能优化</h1> <h2 id="资源的合并与压缩"><a href="#资源的合并与压缩" aria-hidden="true" class="header-anchor">#</a> 资源的合并与压缩</h2> <p>先看下http请求过程
<img src="/nicolas_blog/assets/img/http_request.c5c47477.png" alt="An image"> <code>html</code>压缩，<code>css</code>压缩，<code>js</code>的压缩和合并(不仅缩减，还会代码保护)，开启gzip不多说，<code>webpack</code>解决，说下注意事项，<code>业务代码要和公共代码分开合并</code>，不然开发时，发布的压缩后的代码，用户还要重新缓存一遍。详情见这篇<a href="https://webkws.github.io/nicolas_blog/blogs/webpack.html" target="_blank" rel="noopener noreferrer">blog🚀<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="图片相关的优化"><a href="#图片相关的优化" aria-hidden="true" class="header-anchor">#</a> 图片相关的优化</h2> <h4 id="png8-png24-png32之间的区别"><a href="#png8-png24-png32之间的区别" aria-hidden="true" class="header-anchor">#</a> <code>png8/png24/png32</code>之间的区别</h4> <ul><li>png8 —— 256色 + 支持透明</li> <li>png24 —— 2^24色 + 不支持透明</li> <li>png32 —— 2^24色 + 支持透明</li></ul> <h4 id="针对不同的业务场景选择不同的格式"><a href="#针对不同的业务场景选择不同的格式" aria-hidden="true" class="header-anchor">#</a> 针对不同的业务场景选择不同的格式</h4> <ul><li>jpg有损压缩，压缩率高，不支持透明(大部分不需要透明图片的业务场景)</li> <li>png支持透明，浏览器兼容好(大部分需要透明图片的业务场景)</li> <li>webp压缩程度更好，在ios webview有兼容性问题(安卓全部)</li> <li>svg矢量图，代码内嵌，相对较小，图片样式相对简单的场景(图片样式相对简单)</li></ul> <h4 id="css-sprite-和image-inline"><a href="#css-sprite-和image-inline" aria-hidden="true" class="header-anchor">#</a> <code>css sprite</code> 和<code>image inline</code></h4> <p>雪碧图可以减少http请求次数，image inline小图片直接内嵌到html，base64即可;</p> <h4 id="矢量图，使用svg，使用iconfont解决icon问题"><a href="#矢量图，使用svg，使用iconfont解决icon问题" aria-hidden="true" class="header-anchor">#</a> 矢量图，使用svg，使用<code>iconfont</code>解决<code>icon</code>问题</h4> <h4 id="最后就是图片的压缩"><a href="#最后就是图片的压缩" aria-hidden="true" class="header-anchor">#</a> 最后就是图片的压缩</h4> <p>不多说，nodejs相关工具解决。活动页面可以使用<a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer">tinypng🚀<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="css、js的加载与执行"><a href="#css、js的加载与执行" aria-hidden="true" class="header-anchor">#</a> css、js的加载与执行</h2> <p>看一张浏览器加载渲染的图
<img src="/nicolas_blog/assets/img/html_render.1e08f9a1.png" alt="An image">
顺序如下,摘自stackoverflow</p> <ul><li>The browser receives the <code>response</code>, and <code>parses</code> the HTML (which with 95% probability is broken) in the response</li> <li>A <code>DOM tree</code> is built out of the broken HTML</li> <li><code>New requests</code> are made to the server for each new resource that is found in the HTML source (typically images, style sheets, and JavaScript files).</li> <li>Go back to http request</li> <li><code>Stylesheets</code> are parsed, and the rendering information in each gets attached to the matching node in the DOM tree</li> <li><code>JavaScript</code> is parsed and executed, and DOM nodes are moved and style information is updated accordingly</li> <li>The browser <code>renders</code> the page on the screen according to the DOM tree and the style information for each node</li></ul> <h4 id="html渲染的特点"><a href="#html渲染的特点" aria-hidden="true" class="header-anchor">#</a> html渲染的特点</h4> <ul><li><strong>顺序执行</strong>,每个tag都要从上到下顺序解析。并发加载（所引入的外部资源），因为单个域名的并发请求有限，可以尝试使用3-4个cdn域名</li> <li><strong>是否阻塞</strong>,css的加载不阻塞外部脚本的加载，但是会阻塞js的执行（有可能js依赖css属性）</li> <li><strong>依赖关系</strong>,页面渲染依赖于css的加载，css要放在head里,js的执行顺序的依赖关系,js逻辑对于dom节点的依赖关系</li> <li><strong>引入方式</strong>,link引入css，js也有defer和async</li></ul> <h4 id="懒加载和预加载"><a href="#懒加载和预加载" aria-hidden="true" class="header-anchor">#</a> 懒加载和预加载</h4> <ul><li>懒加载无非就是大多都是图片相关，并发加载的外部资源过多会阻塞js的加载。图片应该在进入可视区后再请求，lazyload，还可以提前placeholder一下比如知乎的手机端，类似这种<a href="https://github.com/michalsnik/vue-content-placeholders" target="_blank" rel="noopener noreferrer">content-placeholders<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>预加载和懒加载相反，是对资源的提前请求，需要在用户空闲时进行（比如登陆页偷偷的进行），也可以从缓存中加载，提高用户的体验。1、img的display:none不会影响页面的渲染，但是会发送请求，等二次的时候直接从缓存中读取了。2、在js中，new一个Image对象，添加src即可。</li></ul> <h2 id="重绘与回流"><a href="#重绘与回流" aria-hidden="true" class="header-anchor">#</a> 重绘与回流 <span class="badge tip top" data-v-099ab69c>0.10.1+</span></h2> <p>因为元素的规模尺寸，布局，隐藏等改变而需要重新构建，称为回流。当<code>render tree</code>中的一些元素需要更新属性，而这些属性只是影响元素的外观，风格，而不会影响布局的，比如<code>background-color</code>。则就叫称为重绘。UI进程和JS进程互相阻塞，这就是css阻塞js的原因。因为部分css会导致浏览器的重绘和回流。回流必将引起重绘，而重绘不一定会引起回流。</p> <h4 id="触发页面重布局的属性，大多structure"><a href="#触发页面重布局的属性，大多structure" aria-hidden="true" class="header-anchor">#</a> 触发页面重布局的属性，大多<code>structure</code></h4> <div class="language-css extra-class"><pre class="language-css"><code>width  height padding margin display border-width border min-height
top bottom left right position float clear text-align overflow-y font-weight
overflow font-family line-height vertival-align white-space font-size
</code></pre></div><h4 id="只触发重绘的属性-大多skin"><a href="#只触发重绘的属性-大多skin" aria-hidden="true" class="header-anchor">#</a> 只触发重绘的属性,大多<code>skin</code></h4> <div class="language-css extra-class"><pre class="language-css"><code>color border-style border-radius visibility text-decoration background outline-color
outline outline-style outline-width box-shadow
</code></pre></div><h4 id="chrome创建图层的条件"><a href="#chrome创建图层的条件" aria-hidden="true" class="header-anchor">#</a> Chrome创建图层的条件</h4> <ul><li>3D或透视变换（<code>perspective transform</code>）CSS属性</li> <li>使用加速视频解码的<code>video</code>节点</li> <li>拥有3D（<code>WebGL</code>）上下文或加速的2D上下文的<code>canvas</code>节点</li> <li>混合插件（如<code>Flash</code>）</li> <li>对自己的<code>opacity</code>做CSS动画或使用一个动画<code>webkit</code>变换的元素</li> <li>拥有加速CSS过滤器的元素</li> <li>元素有一个包含复合层的后代节点（一个元素拥有一个子元素，该子元素在自己的层里）</li> <li>元素有一个<code>z-index</code>较低且包含一个复合层的兄弟元素（换句话说就是该元素在复合层上面渲染）</li></ul> <p>在chrome工具栏的layer可以看</p> <h4 id="实战优化"><a href="#实战优化" aria-hidden="true" class="header-anchor">#</a> 实战优化</h4> <ul><li>用<code>translate</code>替代<code>top</code>改变,因为top会触发Reflow</li> <li>用<code>opacity</code>替代<code>visibility</code></li> <li>不要一条一条地修改 DOM 的样式，预先定义好 class，然后修改 DOM 的 <code>className</code></li> <li>把 DOM 离线后修改，比如：先把 DOM 给 <code>display:none</code>(有一次 Reflow)，然后你修改N次，然后再把它显示出来,不然会多次重绘</li> <li>不要把 DOM 结点的属性值放在一个循环里当成循环里的变量</li> <li>不要使用 <code>table</code> 布局，可能很小的一个小改动会造成整个 <code>table</code> 的重新布局</li> <li>动画实现的速度的选择</li> <li>对于动画新建图层,动画会触发回流，用新图层较好</li> <li>启用 <code>GPU</code> 硬件加速</li></ul> <p><strong>以下摘抄自国外某论坛</strong></p> <ul><li>Whenever possible, avoid changing anyformatting after the initial page load.</li> <li>Whenever possible, use static CSS instead of dynamic CSS.</li> <li>Don’t include CSS rules in the HTTP reply stream if they are not used on the page.</li> <li>Use fixed or absolute positioning as much as possible, especially for animations.</li> <li>Avoid using HTML tables for layout.</li> <li>In animations, reduce the frames per second as much as possible.</li> <li>Avoid asking for layout information. If you must, cache the value rather than asking a second time.</li> <li>Batch DOM changes and apply them all at once.</li> <li>Make changes as low in the DOM tree as possible.</li> <li>Keep in mind that HTMLCollection objects rerun a query every time you access them. Whenever possible, cache the HTMLCollection in an array for future use.</li> <li>Page zoom affects layout performance. Depending on the browser, resizing the window may also affect layout performance.</li> <li>Use as few CSS selectors as you can.</li> <li>Avoid universal and multi-class CSS selectors.</li> <li>Beware the performance of pseudoselectors.</li> <li>Avoid setting multiple inline styles.</li> <li>Change class names instead of styles.</li> <li>Avoid dynamic styles, but if you must use them, change the cssText property instead of the element’s style property.</li> <li>The border-radiusCSS property may be affecting repaint performance more than you think.</li> <li>In Internet Explorer, do not use JavaScript expressions within CSS.</li></ul> <p>查询网址<a href="https://csstriggers.com/" target="_blank" rel="noopener noreferrer">csstriggers🚀<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 参考文档<a href="http://www.stubbornella.org/content/2009/03/27/reflows-repaints-css-performance-making-your-javascript-slow/" target="_blank" rel="noopener noreferrer">REFLOWS &amp; REPAINTS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="浏览器存储"><a href="#浏览器存储" aria-hidden="true" class="header-anchor">#</a> 浏览器存储</h2> <h4 id="cookie"><a href="#cookie" aria-hidden="true" class="header-anchor">#</a> Cookie</h4> <p>因为http是无状态的，所以cookie诞生了，cookie是识别客户端的一个标识。cookie的生成方式，是<code>http response header</code>中返回了<code>set-cookie</code>，服务端生成，客户端维护，还可以通过js写入,但那只是非httponly的cookie。关于cookie的优化，cookie都会被种在<code>domain</code>下，但是并不是所有的请求都需要cookie，比如cdn的域名和主域名要分开，因为静态文件不需要cookie。</p> <p><strong>如图所示cookie都被种在了domain下:</strong></p> <p><img src="/nicolas_blog/assets/img/cookie_http.cdb130e6.png" alt="An image">
上图HTTP打勾对意思就是HTTPONLY的，不允许js修改。</p> <h4 id="localstorage-sessionstorage-indexeddb"><a href="#localstorage-sessionstorage-indexeddb" aria-hidden="true" class="header-anchor">#</a> localStorage, SessionStorage, IndexedDB</h4> <p>这俩设计出来就是做浏览器本地存储的。具有不错的api封装，仅在客户端使用。</p> <p>实战中，可以先从本地读取，后续api请求结束之后再更新它，用户不会感觉到什么。<code>sessionStorage</code>可以用作表单的业务，比如：第一页的填写到第二页的填写，然后用户back了，或者是用户突然刷新了。</p> <p>以上两种对结构化数据来说不太有用，新出了IndexedDB，目前用的不多</p> <h2 id="service-worker"><a href="#service-worker" aria-hidden="true" class="header-anchor">#</a> service worker <span class="badge warning top" data-v-099ab69c>0.10.1+</span></h2> <p>这是一门学问，暂时不会，不多说。</p> <h2 id="缓存"><a href="#缓存" aria-hidden="true" class="header-anchor">#</a> 缓存</h2> <p><strong>看一下淘宝首页的Network</strong>:</p> <p><img src="/nicolas_blog/assets/img/cache_example.b3a6283d.png" alt="An image">
控制缓存策略的机制，cache-control,它可以存在request header中也可以存在response header中。
分为</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//这段时间要用缓存，不会再发请求,它优先级大于expire，status为304</span>
cache<span class="token operator">-</span>control<span class="token punctuation">:</span> max<span class="token operator">-</span>age<span class="token operator">=</span><span class="token number">63072000</span> 
<span class="token comment">//缓存分为 public和private，比如cdn作为中间服务器是public</span>
<span class="token comment">//s-maxage是public的缓存</span>
<span class="token comment">//s-maxage优先级大于max-age</span>
cache<span class="token operator">-</span>control<span class="token punctuation">:</span> max<span class="token operator">-</span>age<span class="token operator">=</span><span class="token number">2592000</span><span class="token punctuation">,</span>s<span class="token operator">-</span>maxage<span class="token operator">=</span><span class="token number">3600</span>
<span class="token comment">//no-cache是发请求到服务端，然后再根据返回比如lastModified，no-store是不用缓存</span>
cache<span class="token operator">-</span>control<span class="token punctuation">:</span><span class="token keyword">private</span><span class="token punctuation">,</span> max<span class="token operator">-</span>age<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> no<span class="token operator">-</span>cache
<span class="token comment">//根据last-modified和if-modified来判断 是否需要更新缓存,相比较来看，ETag的哈希值最佳，因为服务器的时间有可能不准</span>
last<span class="token operator">-</span>modified<span class="token punctuation">:</span> Wed<span class="token punctuation">,</span> <span class="token number">05</span> Jul <span class="token number">2017</span> <span class="token number">07</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">:</span><span class="token number">08</span> <span class="token constant">GMT</span>
</code></pre></div><h2 id="ssr"><a href="#ssr" aria-hidden="true" class="header-anchor">#</a> SSR</h2> <p>以<a href="https://ssr.vuejs.org/" target="_blank" rel="noopener noreferrer">vue-ssr<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>为例.随意打开一个SPA的vue网站，清除缓存后，用<code>performance</code>刷新发现，很大的时间都在加载js，利用客户端的运算能力，加载和执行vue.js相关代码，而ssr是利用了服务端的运算能力。服务端渲染和客户端渲染要注意平衡，哪一块用SSR，哪一块用Client</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">9/5/2018, 4:31:10 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/nicolas_blog/blogs/" class="prev router-link-active">
          Vue Plugin实战
        </a></span> <span class="next"><a href="/nicolas_blog/blogs/issues.html">
          遇到过的Issue
        </a>
        →
      </span></p></div> <div class="bsa-cpc-wrapper"><div class="bsa-cpc"></div></div></div> <!----></div></div>
    <script src="/nicolas_blog/assets/js/21.d6e364bc.js" defer></script><script src="/nicolas_blog/assets/js/3.beca16df.js" defer></script><script src="/nicolas_blog/assets/js/app.8757db7b.js" defer></script>
  </body>
</html>
